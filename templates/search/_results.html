{% load manage_form_tags %}
{% load i18n %}

{% if primary_page == "ui_search.results" or primary_page == "ui_manage.index" and authenticatedUser %}
<div class="alert alert-warning text-left row">
   <form class="col-sm-8 customize-table__heading-wrapper" action="{% url primary_page %}" role="form">
      <h2 class="customize-table__heading">{{ heading_title }}</h2>
      {% if primary_page == "ui_manage.index" and filtered %}
      <input name="ps" type="hidden" value="{{ ps }}" />
      <input name="p" type="hidden" value="{{ p }}" />
      <input name="order_by" type="hidden" value="{{ order_by }}" />
      <input name="sort" type="hidden" value="{{ sort }}" />
      <input name="owner_selected" type="hidden" value="{{ owner_selected }}" />
      {% autoescape off %}{% column_choices_hidden fields_selected %}{% endautoescape %}
      <button class="btn btn-primary">{% trans "See All Identifiers" %}</button>
      {% endif %}
   </form>
   {% if results|length > 0 %}
   <div class="col-sm-4 text-right">
      <button class="btn btn-primary" data-toggle="modal" data-target="#myModal" type="button">{% trans "Customize View" %}</button>
   </div>
   {% endif %}
</div>
{% include "search/_choose_cols.html" with primary_page=primary_page %}
{% endif %}

{% if primary_page == "ui_manage.index" and authenticatedUser %}
<div class="container">
   <div class="col-sm-8">
      <form id="owner_filter_form" action="{% url primary_page %}" method="get" role="form">
         {% autoescape off %}{% rewrite_hidden REQUEST %}{% endautoescape %}
         <label for="owner_selected" class="form-label text-primary">{% trans "View identifiers owned by" %}:</label>

         {% include "includes/owner_select.html" %}

      </form>
   </div>
   {% if total_results > 0 %}
   <div class="col-sm-4 text-right">
      <form action="{% url "ui_manage.download" %}" method="get" role="form">
         <input name="owner_selected" type="hidden" value="{{ owner_selected }}" />
         <button id="download" class="btn btn-primary">{% trans "Download All" %}</button>
      </form>
   </div>
   {% endif %}
</div>
<script type="text/javascript">
   $(document).ready(function() {
      // submit form when owner filter changes
      $("#owner_selected").bind("change", function(event) {
         var frm = $('#owner_filter_form');
         frm.attr('action', location.pathname);
         frm.unbind('submit');
         frm.attr('method', 'get');
         frm.submit();
         setTimeout(function() {
            loadingIndicator();
         }, 4000);
      });
      // Record a Google Analytics event when user clicks "Download All"
      $('#download').on('keypress click', function() {
         GA_EVENT_LIB.init("Manage Download Id_csv");
         GA_EVENT_LIB.record_ga_event();
      });
   });
</script>
{% endif %}

{% if total_results < 1 %}
<p class="manage__note"><strong>{% trans "No identifiers found for the query you entered" %}.</strong></p>
<br /><br /><br /><br /><br /><br /><br />
{% else %}

{% if total_results > 10 %}
{% autoescape off %}{% include "search/_pagination.html" with primary_page=primary_page select_position="top" %}{% endautoescape %}
{% endif %}

<table class="table">
   {% autoescape off %}{% header_row REQUEST fields_selected fields_mapped order_by sort primary_page %}{% endautoescape %}
   <tbody>
      {% for item in results %}
      <tr>
         {% autoescape off %}{% data_row item fields_selected field_display_types testPrefixes "table3" %}{% endautoescape %}
      </tr>
      {% endfor %}
   </tbody>
</table>

{% if total_results > 10 %}
{% autoescape off %}{% include "search/_pagination.html" with primary_page=primary_page select_position="bottom" %}{% endautoescape %}
{% endif %}

{% if primary_page == "ui_manage.index" %}
<p class="manage__note">&#42; {% trans "Indicates demo identifier" %}</p>
{% endif %}
{% endif %}
